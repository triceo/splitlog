<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-03-11 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150311" />
    <meta http-equiv="Content-Language" content="en" />
    <title>splitlog: Watching Your Logs &#x2013; Splitlog User Guide</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/triceo/splitlog">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>splitlog: watching your logs</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-03-11
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.7.0
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Usage</li>
                              
      <li>
  
                          <a href="../user_guide/introduction.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                                                                                                          
      <li>
  
                          <a href="../user_guide/features.html" title="Features">
          <i class="icon-chevron-down"></i>
        Features</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../user_guide/metrics.html" title="Metrics">
          <i class="none"></i>
        Metrics</a>
            </li>
                    
      <li>
  
                          <a href="../user_guide/merging.html" title="Merging Followers">
          <i class="none"></i>
        Merging Followers</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><i class="none"></i>Expectations</a>
          </li>
              </ul>
        </li>
                                                                                                
      <li>
  
                          <a href="../user_guide/advanced.html" title="Deep Down">
          <i class="icon-chevron-down"></i>
        Deep Down</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../user_guide/message_lifecycle.html" title="Message Lifecycle">
          <i class="none"></i>
        Message Lifecycle</a>
            </li>
                    
      <li>
  
                          <a href="../user_guide/splitting.html" title="Splitting">
          <i class="none"></i>
        Splitting</a>
            </li>
                    
      <li>
  
                          <a href="../user_guide/memory.html" title="Memory Management">
          <i class="none"></i>
        Memory Management</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="../faq.html" title="Frequently Asked Questions">
          <i class="none"></i>
        Frequently Asked Questions</a>
            </li>
                                        <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="../splitlog-api/index.html" title="splitlog-api: the public APIs">
          <i class="none"></i>
        splitlog-api: the public APIs</a>
            </li>
                
      <li>
  
                          <a href="../splitlog-core/index.html" title="splitlog-core: the client library">
          <i class="none"></i>
        splitlog-core: the client library</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                              
      <li>
  
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="$sitesearchValue" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section">
<h2><a name="Splitlog_User_Guide"></a>Splitlog User Guide</h2>
<div class="section">
<h3><a name="Splitlog_Features:_Expectations"></a><i>Splitlog</i> Features: Expectations</h3>
<p>This document will explain how you can use <i>Splitlog</i> to block execution of your application until a given <tt>Message</tt> shows up in the watched log. This is especially useful inside tests for web applications, where the progress of some operation is only signalled via the server log.</p>
<div class="section">
<h4><a name="What_are_expectations"></a>What are expectations?</h4>
<p>Expectations are a mechanism through which <i>Splitlog</i> allows you to block any thread until a particular condition is met. There are several kinds of expectations, but they all share some common properties:</p>

<ul>
  
<li>Each expectation is acquired by providing a condition that needs to be true for the expectation to unblock.</li>
  
<li>The condition is evaluated every time a new <tt>Message</tt> is received by the message consumer. Expectations will not be triggered if the given consumer, say a <tt>Follower</tt>, isn&#x2019;t following at the time when the <tt>Message</tt> arrives.</li>
  
<li>Expectations return a <tt>java.util.concurrent.Future&lt;Message&gt;</tt> instance. When you call the <tt>get()</tt> method, the current thread will be blocked until the original condition becomes true. After then, it will always be true - it is therefore recommended to not store the <tt>Future</tt> instances and allow them to be properly garbage-collected.</li>
</ul></div>
<div class="section">
<h4><a name="Expectations_on_Followers"></a>Expectations on Followers</h4>
<p>The most obvious use case for expectations is to use them on <tt>Follower</tt> instances, in order to block for a particular kind of <tt>Message</tt>. Let&#x2019;s say we want to wait until an <tt>ERROR</tt> shows up in the server log. First, let&#x2019;s create the condition:</p>

<div class="source">
<div class="source">
<pre>  MidDeliveryMessageCondition&lt;LogWatch&gt; condition = new MidDeliveryMessageCondition&lt;LogWatch&gt;() {
    @Override
    public boolean accept(Message message, MessageDeliveryStatus status, LogWatch source) {
      return (message.getSeverity() == MessageSeverity.ERROR);
    }
  }
</pre></div></div>
<p>There are a few noteworthy things in this example:</p>

<ul>
  
<li>The <tt>MessageDeliveryStatus</tt> - for an explanation of those, please refer to <a href="message_lifecycle.html">Message Lifecycle</a> documentation. Generally, this condition can become true irregardless of where the <tt>Message</tt> is in its lifecycle.</li>
  
<li>The <tt>source</tt> property will contain the code that has notified this condition of the new <tt>Message</tt>. In case the expectation is being triggered by a <tt>Follower</tt>, the messages will be coming directly from <tt>LogWatch</tt> as is the case here. For <tt>MergingFollower</tt> the messages will be provided by <tt>Follower</tt>. This can be very useful in case you need to find out the source file for those messages etc.</li>
</ul>
<p>The next step is to actually trigger the expectation:</p>

<div class="source">
<div class="source">
<pre>  Follower f = ...; // acquire follower instance here
  Future&lt;Message&gt; expectation = f.expect(condition); // this is your expectation
</pre></div></div>
<p>And now, here&#x2019;s how you block:</p>

<div class="source">
<div class="source">
<pre>  try {
    Message result = expectation.get(); // this will block until condition is made true by incoming Messages
    // &quot;result&quot; holds your message now
    System.out.printn(&quot;An error has been caught: &quot; + result);
  } catch (InterruptedException e) {
    System.out.println(&quot;The thread has been interrupted.&quot;);
  } catch (ExecutionException e) {
    System.out.println(&quot;An exception has been thrown in the user code.&quot;);
  }
</pre></div></div>
<p>Please note that this particular example requires a properly configured <tt>TailSplitter</tt> that will understand the severity of log messages. Please refer to the section on <a href="splitting.html">Splitting</a> for more information.</p></div>
<div class="section">
<h4><a name="Expectations_on_Metrics"></a>Expectations on Metrics</h4>
<p>For some general information on <tt>Metric</tt>s, please see the <a href="metrics.html">chapter about them</a>. Here, we&#x2019;ll focus merely on how to set expectations on top of them. You&#x2019;ll see nothing much will change from the previous example. First, the condition changes a bit:</p>

<div class="source">
<div class="source">
<pre>  MessageMetricCondition&lt;Integer, LogWatch&gt; condition = new MessageMetricCondition&lt;Integer, LogWatch&gt;() {

    @Override
    public boolean accept(final MessageMetric&lt;Integer, LogWatch&gt; evaluate) {
        return evaluate.getValue() == 65;
    }

  }
</pre></div></div>
<p>Couple things to note:</p>

<ul>
  
<li>This condition will trigger when the value of the metric reaches 65, and only then. A more reliable way of writing this condition would, however, be using &#x201c;greather than&#x201d; instead of &#x201c;is equal to&#x201d;; just in case some message pushes the metric over the threshold.</li>
  
<li>Metrics are generified to be able to return custom numeric types. The first generic type refers to the numeric type of the metric. The second type is the source and we already covered that in the previous example.</li>
  
<li>The syntax here is a bit too chatty, with all the generics. However, if you use Java 7, you can get rid of most of that using the diamond operator.</li>
</ul>
<p>The rest of the code remains mostly identical to the previous example:</p>

<div class="source">
<div class="source">
<pre>  Follower f = ...; // acquire follower instance here
  MessageMetric&lt;Integer, LogWatch&gt; m = f.startMeasuring(...); // acquire metric here
  Future&lt;Message&gt; expectation = m.expect(condition); // this is your expectation
  try {
    Message result = expectation.get(); // this will block until condition is made true by incoming Messages
    // &quot;result&quot; holds your message now
    System.out.printn(&quot;An error has been caught: &quot; + result);
  } catch (Exception e) {
    // handle exceptions
  }
</pre></div></div>
<p>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-</p>
<div class="section">
<h5><a name="Something_wrong"></a>Something wrong?</h5>
<p>Think you spotted a mistake in this document? A typo? Factual inaccuracy? <a class="externalLink" href="https://github.com/triceo/splitlog/edit/master/src/site/markdown/user_guide/expectations.md.vm">Make an edit</a>. Think of the legions of grateful users!</p></div></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                        <p class="pull-right">Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
        </div>

        
        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="http://www.ohloh.net/p/715136/widgets/project_factoids.js"></script>
    </div>
        </div>
    </footer>
        </body>
</html>
