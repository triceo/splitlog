<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-03-12 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150312" />
    <meta http-equiv="Content-Language" content="en" />
    <title>splitlog: Watching Your Logs &#x2013; Splitlog User Guide</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/triceo/splitlog">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>splitlog: watching your logs</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-03-12
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.7.1
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Usage</li>
                              
      <li>
  
                          <a href="../user_guide/introduction.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                                                                                                          
      <li>
  
                          <a href="../user_guide/features.html" title="Features">
          <i class="icon-chevron-down"></i>
        Features</a>
                    <ul class="nav nav-list">
                    
      <li class="active">
  
            <a href="#"><i class="none"></i>Metrics</a>
          </li>
                    
      <li>
  
                          <a href="../user_guide/merging.html" title="Merging Followers">
          <i class="none"></i>
        Merging Followers</a>
            </li>
                    
      <li>
  
                          <a href="../user_guide/expectations.html" title="Expectations">
          <i class="none"></i>
        Expectations</a>
            </li>
              </ul>
        </li>
                                                                                                
      <li>
  
                          <a href="../user_guide/advanced.html" title="Deep Down">
          <i class="icon-chevron-down"></i>
        Deep Down</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../user_guide/message_lifecycle.html" title="Message Lifecycle">
          <i class="none"></i>
        Message Lifecycle</a>
            </li>
                    
      <li>
  
                          <a href="../user_guide/splitting.html" title="Splitting">
          <i class="none"></i>
        Splitting</a>
            </li>
                    
      <li>
  
                          <a href="../user_guide/memory.html" title="Memory Management">
          <i class="none"></i>
        Memory Management</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="../faq.html" title="Frequently Asked Questions">
          <i class="none"></i>
        Frequently Asked Questions</a>
            </li>
                                        <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="../splitlog-api/index.html" title="splitlog-api: the public APIs">
          <i class="none"></i>
        splitlog-api: the public APIs</a>
            </li>
                
      <li>
  
                          <a href="../splitlog-core/index.html" title="splitlog-core: the client library">
          <i class="none"></i>
        splitlog-core: the client library</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                              
      <li>
  
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="$sitesearchValue" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section">
<h2><a name="Splitlog_User_Guide"></a>Splitlog User Guide</h2>
<div class="section">
<h3><a name="Splitlog_Features:_Metrics"></a><i>Splitlog</i> Features: Metrics</h3>
<p>This document will explain how you can use <i>Splitlog</i> to gather various statistical data from your log files.</p>
<div class="section">
<h4><a name="What_are_metrics"></a>What are metrics?</h4>
<p>Metrics are a simple way to maintain various counts based on <tt>Message</tt> contents and metadata. You choose what to measure and <i>Splitlog</i> will make sure that the metric is updates every time a new <tt>Message</tt> is received.</p>
<p>A measure is a user-provided class that implements the MessageMeasure interface. The interface requires you to provide the following:</p>

<ol style="list-style-type: decimal">
  
<li>Numeric type to calculate in. It is entirely up to you and would typically be <tt>Integer</tt>, altough other alternatives like <tt>BigDecimal</tt> will work equally well.</li>
  
<li>Initial value of the metric. Most typically zero, in the representation typical for the chosen numeric type.</li>
  
<li>Implementation of the <tt>update()</tt> method that will take current value of the metric and update it based on the <tt>Message</tt> being processed.</li>
</ol>
<p>Users are encouraged to implement these as stateless. Otherwise, unpredictable behavior can occur, as the measures may be shared across multiple metrics.</p></div>
<div class="section">
<h4><a name="Using_metrics_on_Followers"></a>Using metrics on Followers</h4>
<p>The most typical use case would be to measure the number of Messages that come through your <tt>Follower</tt>. Here&#x2019;s how you do that; first, create your MessageMeasure implementation:</p>

<div class="source">
<div class="source">
<pre>  MessageMeasure&lt;Integer, LogWatch&gt; messageCounter = new MessageMeasure&lt;Integer, LogWatch&gt;() {

    @Override
    public Integer initialValue() {
        return 0; // start with zero
    }

    @Override
    public Integer update(MessageMetric&lt;Integer, LogWatch&gt; metric, Message evaluate, MessageDeliveryStatus status, LogWatch source) {
        if (status != MessageDeliveryStatus.ACCEPTED) {
            // don't increment for INCOMING messages
            return metric.getValue();
        } else {
            // one fully processed new message in the log
            return metric.getValue() + 1;
        }
    }

  };
</pre></div></div>
<p>Fairly straight-forward, isn&#x2019;t it? You may want to check out what the <tt>MessageDeliveryStatus</tt> is though, in the <a href="message_lifecycle.html">Message Lifecycle</a> chapter. Now, let&#x2019;s move on to how you convert this into a working metric.</p>

<div class="source">
<div class="source">
<pre>  Follower f = ...; // obtain your follower
  MessageMetric&lt;Integer, LogWatch&gt; m = f.startMeasuring(messageCounter, &quot;Some Metric ID&quot;);
  Integer messageCount = m.getValue(); // should be zero, unless any messages arrived in the meantime
</pre></div></div>
<p>Notice the &#x201c;Some Metric ID&#x201d;? You can use this later to retrieve your metric instance using <tt>Follower.getMetric(String)</tt> method, if you ever need it. Oh and you can also use <a href="expectations.html">expectations on metrics</a>.</p></div>
<div class="section">
<h4><a name="Handing_metrics_down"></a>Handing metrics down</h4>
<p>Metrics can be used on all kinds of followers and also on <tt>LogWatch</tt>. However, there is something special about <tt>LogWatch</tt>, and that is its support for handing metrics down.</p>
<p>Measures registered through the <tt>LogWatch.startHandingDown(MessageMeasure, String)</tt> method will be handed down to any follower that is subsequently started from the same <tt>LogWatch</tt>. You can use this to have a different instance of your message counter from above for every follower that you create. This instance can be retrieved from the follower by using the textual ID that you provided to the <tt>LogWatch</tt> during registration.</p>
<p>When you no longer want future followers to measure this particular kind of data, simply call <tt>LogWatch.stopHandingDown(String)</tt> with the textual ID you provided originally. Be aware that this will not in any way affect the followers and metrics that already exist. </p>
<div class="section">
<h5><a name="References"></a>References</h5>

<ol style="list-style-type: decimal">
  
<li><a href="../apidocs/com/github/triceo/splitlog/api/MessageMeasure.html">MessageMeasure Javadoc</a>.</li>
  
<li><a href="../apidocs/com/github/triceo/splitlog/api/MessageMetric.html">MessageMetric Javadoc</a>.</li>
  
<li><a href="../apidocs/com/github/triceo/splitlog/api/LogWatch.html">LogWatch Javadoc</a>.</li>
  
<li><a href="../apidocs/com/github/triceo/splitlog/api/CommonFollower.html">CommonFollower Javadoc</a>.</li>
</ol>
<p>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-</p></div>
<div class="section">
<h5><a name="Something_wrong"></a>Something wrong?</h5>
<p>Think you spotted a mistake in this document? A typo? Factual inaccuracy? <a class="externalLink" href="https://github.com/triceo/splitlog/edit/master/src/site/markdown/user_guide/metrics.md.vm">Make an edit</a>. Think of the legions of grateful users!</p></div></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                        <p class="pull-right">Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
        </div>

        
        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="http://www.ohloh.net/p/715136/widgets/project_factoids.js"></script>
    </div>
        </div>
    </footer>
        </body>
</html>
